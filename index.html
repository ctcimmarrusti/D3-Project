<!DOCTYPE html>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<!-- <script src="https://github.com/susielu/d3-annotation/blob/master/d3-annotation.js"></script> -->
"></script>

<body onload= 'init()'>
<style>
  .states{
    fill:#ad5c08;
  }

  .nation{
    fill:none;
    stroke:black
  }
  .states :hover {
    fill-opacity: .7;
  }
  .datebuttons :hover{
    fill-opacity: .5;
  }


  .state-borders {
    fill: none;
    stroke: black;
    stroke-width: 0.5px;
    stroke-linejoin: round;
    stroke-linecap: round;
    pointer-events: none;
  }
</style>


<svg width="1110" height="600">
</svg>

<!-- build the buttons -->
<script>
   // set values for most of this. map optomized at 960 x 600 so buttons are
   // set to 600 x 100
  var bcount = 14,
  bwidth = 200,
  svgwidth = (960 +bwidth)
  svgheight = 600,
  bheight = (svgheight/bcount);


  function init(){
    const formatTime = d3.timeFormat("%B %d, %Y");
    var svg = d3.select("svg")
    //get dates list in csv format... couldve hard coded I suppose
    d3.csv("https://raw.githubusercontent.com/ctcimmarrusti/D3-Project/main/dates.csv", function(data){
      button = d3.select("svg")  // build g append rect and text
        .append("g")
        .attr("class", "datebuttons")
        .selectAll("g")
        .data(data)
        .enter()
        .append("g")
        .attr("transform", function(d,i){return ("translate("+(svgwidth-bwidth)+", "+(svgheight * i / bcount)+ ")");})
      button.append("rect") //append rect
        .attr("width", bwidth)
        .attr("height", bheight)
        .style("fill", "#0859AD")
        .style("opacity", function(d,i){ //modifying opacity to separate rects
          console.log(i)
          return (i+2)/(bcount+2);})//allows for scaling but gives cushion from fully opaque
      button.append("text")
        .text(function(d){return formatTime(d3.isoParse(d.Dayz));})
        .style("opacity", 1)
        .attr("y", bheight/2)
        .attr("x", 10)
        .attr("width", bwidth)
      })
  }






var path = d3.geoPath();
// d3.csv("")
d3.json("https://d3js.org/us-10m.v1.json", function(error, us) {
  if (error) throw error;
  var svg = d3.select("svg");
  // Copy the data value into the JSON
  // json.features[j].properties.visited = dataValue;

  d3.select("svg")
    .append("g")
    .attr("class", "states")
    .selectAll("path")
    .data(topojson.feature(us, us.objects.states).features)
    .enter()
    .append("path")
    .attr("d", path);

  svg.append("path")
    .attr("class", "state-borders")
    .attr("d", path(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; })));

  svg.append("path")
    .attr("class","nation")
    .attr("d", path(topojson.mesh(us, us.objects.nation)))
});

</script>
